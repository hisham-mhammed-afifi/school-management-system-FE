# Frontend Architecture Reference

> Auto-generated by Frontend Expert Agent on 2026-02-18
> THIS FILE IS THE SOURCE OF TRUTH. All agents must follow these patterns.

## Tech Stack

- **Angular**: 21 (latest)
- **UI Library**: Custom (no PrimeNG/Material — Tailwind + semantic tokens)
- **Styling**: Tailwind CSS 4.1 + CSS custom properties (semantic design tokens)
- **State Management**: Angular Signals (`signal()`, `computed()`, `effect()`)
- **i18n**: ngx-translate 17 (HTTP loader from JSON files)
- **Forms**: Reactive Forms (Angular built-in, not yet implemented)
- **HTTP**: Angular `HttpClient` with functional interceptors
- **Testing**: Vitest 4 (unit) + Playwright 1.58 (e2e)
- **Build**: Angular CLI 21
- **CDK**: `@angular/cdk` installed (overlay, a11y, drag-drop, layout, bidi, etc.)
- **Other notable deps**: `@angular/cdk`, `@ngx-translate/core`, `@ngx-translate/http-loader`

## Project Structure

```
src/
├── main.ts                             # bootstrapApplication(App, appConfig)
├── index.html                          # HTML shell with dark-mode detection script
├── styles.css                          # Global styles: Tailwind imports + semantic tokens
├── app/
│   ├── app.ts                          # Root component (standalone)
│   ├── app.html                        # Root template
│   ├── app.css                         # :host { display: block; }
│   ├── app.spec.ts                     # Root component tests
│   ├── app.config.ts                   # Providers: router, http, i18n, error handler
│   ├── app.routes.ts                   # Route config (empty — commented examples)
│   ├── core/                           # Singletons: services, guards, interceptors
│   │   ├── services/
│   │   │   ├── theme.service.ts        # Theme management (signals + localStorage)
│   │   │   ├── theme.service.spec.ts
│   │   │   ├── translation.service.ts  # i18n + RTL management (signals)
│   │   │   ├── translation.service.spec.ts
│   │   │   ├── error-handler.service.ts # Global ErrorHandler implementation
│   │   │   └── error-handler.service.spec.ts
│   │   ├── interceptors/
│   │   │   ├── api.interceptor.ts      # Rewrites /api/* → environment.apiUrl
│   │   │   ├── api.interceptor.spec.ts
│   │   │   ├── error.interceptor.ts    # 401→login, 403→forbidden
│   │   │   └── error.interceptor.spec.ts
│   │   └── guards/
│   │       └── auth.guard.ts           # Placeholder (always returns false)
│   ├── shared/                         # Reusable components, directives, pipes
│   │   └── components/
│   │       ├── theme-toggle/
│   │       │   ├── theme-toggle.ts     # Light/System/Dark radio group
│   │       │   └── theme-toggle.spec.ts
│   │       └── language-switcher/
│   │           ├── language-switcher.ts # EN/AR toggle button
│   │           └── language-switcher.spec.ts
│   └── features/                       # (empty — ready for lazy-loaded features)
└── environments/
    ├── environment.ts                  # { production: false, apiUrl: 'http://localhost:3000/api' }
    ├── environment.production.ts       # { production: true, apiUrl: '/api' }
    └── environment.staging.ts          # { production: true, apiUrl: 'https://staging-api.example.com/api' }
```

**Status**: Freshly scaffolded project with core infrastructure in place. No feature modules implemented yet.

## Path Aliases

| Alias       | Maps To                        | Usage                                  |
| ----------- | ------------------------------ | -------------------------------------- |
| `@core/*`   | `src/app/core/*`               | Services, guards, interceptors         |
| `@shared/*` | `src/app/shared/*`             | Reusable components, directives, pipes |
| `@app/*`    | `src/app/*`                    | Any app-level import                   |
| `@env`      | `src/environments/environment` | Environment config                     |

**Rule**: Always use path aliases. Never use relative imports across module boundaries.

## Routing

### Route Tree

Currently empty. Commented examples show the intended pattern:

```typescript
// Example from app.routes.ts comments:
export const routes: Routes = [
  {
    path: 'dashboard',
    loadComponent: () => import('./features/dashboard/dashboard').then((m) => m.DashboardComponent),
    canActivate: [authGuard],
  },
  {
    path: 'login',
    loadComponent: () => import('./features/auth/login').then((m) => m.LoginComponent),
  },
  { path: '**', redirectTo: 'dashboard' },
];
```

### Lazy Loading Pattern

- Use `loadComponent()` with dynamic imports in route definitions
- Each feature gets its own folder under `features/`
- Guards applied at route level

### Guards & Resolvers

| Guard       | Path                        | Status      | Logic                                                                 |
| ----------- | --------------------------- | ----------- | --------------------------------------------------------------------- |
| `authGuard` | `core/guards/auth.guard.ts` | Placeholder | Always returns false, redirects to `/login`. TODO: inject AuthService |

## Component Conventions

> Based on analysis of all existing components (App, ThemeToggle, LanguageSwitcher)

| Convention       | Pattern                 | Example                                                     |
| ---------------- | ----------------------- | ----------------------------------------------------------- |
| Standalone       | **Yes, always**         | `standalone: true` (no NgModules, ever)                     |
| Inputs/Outputs   | **Not yet used**        | Will use signal inputs when needed                          |
| Change Detection | **Default**             | Not explicitly set on any component                         |
| Control Flow     | **`@for` / `@if`**      | `@for (option of options; track option.value)`              |
| DI Style         | **`inject()` function** | `protected readonly themeService = inject(ThemeService);`   |
| Template         | **External**            | `templateUrl: './app.html'` (except small inline templates) |
| Styles           | **External**            | `styleUrl: './app.css'` (minimal `:host` styles)            |
| Selector Prefix  | **`app-`**              | `selector: 'app-theme-toggle'`                              |
| File naming      | **No suffix**           | `theme-toggle.ts` not `theme-toggle.component.ts`           |

**When creating new components, follow these exact patterns.**

### Component File Template

```typescript
import { Component, inject } from '@angular/core';

@Component({
  selector: 'app-my-component',
  standalone: true,
  imports: [
    /* dependencies */
  ],
  templateUrl: './my-component.html',
  styleUrl: './my-component.css',
})
export class MyComponent {
  private readonly someService = inject(SomeService);
  // Use signal() for local state
  // Use computed() for derived state
  // Use inject(DestroyRef) for cleanup
}
```

## Service Conventions

| Convention       | Pattern                                              |
| ---------------- | ---------------------------------------------------- |
| Injectable scope | `@Injectable({ providedIn: 'root' })` for singletons |
| State management | Signals: `signal()`, `computed()`, `effect()`        |
| Cleanup          | `inject(DestroyRef).onDestroy(() => ...)`            |
| HTTP calls       | Not yet implemented — see interceptor patterns below |
| Storage          | localStorage with typed keys                         |

### HTTP Call Pattern (from interceptors)

```typescript
// API interceptor rewrites URLs:
// Request to:  /api/v1/students
// Becomes:     http://localhost:3000/api/v1/students (dev)
//              /api/v1/students (production, same-origin)

// Error interceptor handles:
// 401 → navigate to /login
// 403 → navigate to /forbidden
// 0   → network error (logged only)
// All errors re-thrown (not swallowed)
```

### Base URL Configuration

```typescript
// src/environments/environment.ts
export const environment = {
  production: false,
  apiUrl: 'http://localhost:3000/api', // Backend runs on port 3000
};
```

**When creating new services, follow these exact patterns.**

## Styling Conventions

### Structure

- **Global**: `src/styles.css` — Tailwind imports + semantic tokens in `:root` and `.dark`
- **Component**: External CSS files (minimal, usually just `:host { display: block; }`)
- **Approach**: Tailwind utility classes directly in templates

### Semantic Design Tokens

All colors use CSS custom properties. **Never hardcode Tailwind colors** (no `text-red-500`, `bg-gray-300`).

#### Available Tokens

| Token                 | Light Value | Dark Value | Usage                           |
| --------------------- | ----------- | ---------- | ------------------------------- |
| `bg-bg-primary`       | white       | #0f172a    | Page background                 |
| `bg-bg-secondary`     | #f1f5f9     | #1e293b    | Secondary backgrounds           |
| `text-text-primary`   | #0f172a     | #f8fafc    | Primary text                    |
| `text-text-secondary` | #475569     | #94a3b8    | Secondary text                  |
| `border-border`       | #e2e8f0     | #334155    | Borders                         |
| `bg-accent`           | #2563eb     | #3b82f6    | Primary accent (buttons, links) |
| `bg-accent-hover`     | #1d4ed8     | #2563eb    | Accent hover                    |
| `text-accent-text`    | white       | white      | Text on accent                  |
| `bg-danger`           | #dc2626     | #ef4444    | Danger/delete                   |
| `bg-danger-hover`     | #b91c1c     | #dc2626    | Danger hover                    |
| `text-danger-text`    | white       | white      | Text on danger                  |
| `bg-success-bg`       | #f0fdf4     | #052e16    | Success background              |
| `text-success-text`   | #166534     | #4ade80    | Success text                    |
| `bg-error-bg`         | #fef2f2     | #450a0a    | Error background                |
| `text-error-text`     | #991b1b     | #fca5a5    | Error text                      |
| `bg-info-bg`          | #eff6ff     | #172554    | Info background                 |
| `text-info-text`      | #1e40af     | #93c5fd    | Info text                       |
| `bg-surface`          | #f8fafc     | #1e293b    | Card/surface background         |
| `bg-surface-hover`    | #f1f5f9     | #334155    | Surface hover                   |
| `shadow-card`         | custom      | custom     | Card shadow                     |

#### Gradient Tokens

| Token                    | Usage                |
| ------------------------ | -------------------- |
| `--color-gradient-start` | Gradient backgrounds |
| `--color-gradient-end`   | Gradient backgrounds |

### RTL / Logical Properties

| Do                       | Don't                             |
| ------------------------ | --------------------------------- |
| `ps-5`                   | `pl-5`                            |
| `pe-3`                   | `pr-3`                            |
| `ms-2`                   | `ml-2`                            |
| `me-2`                   | `mr-2`                            |
| `text-start`             | `text-left`                       |
| `inset-inline-start`     | `left`                            |
| `border-s`               | `border-l`                        |
| `not-first:border-s`     | `not-first:border-l`              |
| `clip-path: inset(50%)`  | `left: -9999px` (for hiding)      |
| `border-0` (conditional) | `border-none` (kills all borders) |

### Dark Mode

- Toggle via `.dark` class on `<html>` element
- Three modes: Light, System (OS preference), Dark
- Theme stored in localStorage key `'theme'`
- CSS variables swap automatically between `:root` and `.dark` selectors

### Responsive Approach

- Mobile-first with Tailwind responsive prefixes (`sm:`, `md:`, `lg:`)
- CDK `BreakpointObserver` available for programmatic breakpoints

**When writing styles, follow these exact patterns.**

## Shared Components Library

| Component        | Path                                                       | Purpose                          | Inputs                               | Outputs                             |
| ---------------- | ---------------------------------------------------------- | -------------------------------- | ------------------------------------ | ----------------------------------- |
| ThemeToggle      | `shared/components/theme-toggle/theme-toggle.ts`           | Light/System/Dark theme selector | None (reads from ThemeService)       | None (writes to ThemeService)       |
| LanguageSwitcher | `shared/components/language-switcher/language-switcher.ts` | EN/AR language toggle            | None (reads from TranslationService) | None (writes to TranslationService) |

## Core Services

| Service            | Path                                     | Purpose                                                                    |
| ------------------ | ---------------------------------------- | -------------------------------------------------------------------------- |
| ThemeService       | `core/services/theme.service.ts`         | Theme management: signal-based, localStorage, OS preference, `.dark` class |
| TranslationService | `core/services/translation.service.ts`   | i18n + RTL: signal-based, localStorage, document.dir/lang                  |
| GlobalErrorHandler | `core/services/error-handler.service.ts` | Catches unhandled errors, gates console behind `!production`               |

### ThemeService API

```typescript
// Types
type Theme = 'light' | 'dark' | 'system';
type ResolvedTheme = 'light' | 'dark';

// Signals (read in templates)
theme: Signal<Theme>                    // Current user preference
resolvedTheme: Signal<ResolvedTheme>    // Resolved actual theme
osDark: Signal<boolean>                 // OS dark mode preference

// Methods
setTheme(theme: Theme): void            // Set and persist theme
```

### TranslationService API

```typescript
// Types
type AppLanguage = 'en' | 'ar';

// Signals (read in templates)
currentLang: Signal<AppLanguage>        // Current language
direction: Signal<Direction>            // 'ltr' or 'rtl'

// Properties
availableLanguages: readonly AppLanguage[]  // ['en', 'ar']

// Methods
init(): void                            // Call once at app startup
switchLanguage(lang: AppLanguage): void  // Change language
```

## Interceptors

| Name             | Path                                     | Type                | Purpose                                              |
| ---------------- | ---------------------------------------- | ------------------- | ---------------------------------------------------- |
| apiInterceptor   | `core/interceptors/api.interceptor.ts`   | `HttpInterceptorFn` | Rewrites `/api/*` URLs to `environment.apiUrl`       |
| errorInterceptor | `core/interceptors/error.interceptor.ts` | `HttpInterceptorFn` | 401→`/login`, 403→`/forbidden`, re-throws all errors |

**Registration order** in `app.config.ts`: `withInterceptors([apiInterceptor, errorInterceptor])`

## Guards

| Name      | Path                        | Type            | Purpose                                                   |
| --------- | --------------------------- | --------------- | --------------------------------------------------------- |
| authGuard | `core/guards/auth.guard.ts` | `CanActivateFn` | Placeholder — always returns false, redirects to `/login` |

## Models & Interfaces

No models or interfaces defined yet. The backend uses UUIDs for all IDs and returns ISO date strings.

## i18n

### Translation Files

| File    | Path                         |
| ------- | ---------------------------- |
| English | `public/assets/i18n/en.json` |
| Arabic  | `public/assets/i18n/ar.json` |

### Key Structure

```
SECTION.KEY format:
  COMMON.APP_NAME, COMMON.SAVE, COMMON.CANCEL, COMMON.DELETE, ...
  AUTH.LOGIN, AUTH.LOGOUT, AUTH.EMAIL, AUTH.PASSWORD, ...
  NAV.HOME, NAV.ABOUT, NAV.SETTINGS, NAV.PROFILE
  VALIDATION.REQUIRED, VALIDATION.MIN_LENGTH, VALIDATION.MAX_LENGTH, VALIDATION.INVALID_EMAIL
```

### Usage in Templates

```html
<!-- Pipe (for inline text) -->
{{ 'AUTH.LOGIN' | translate }}

<!-- Directive (for element content) -->
<span [translate]="'NAV.HOME'"></span>

<!-- With interpolation -->
{{ 'AUTH.WELCOME' | translate:{ name: userName } }}
```

### Adding New Keys

Add to both `en.json` and `ar.json` using `SECTION.KEY` format.

## Testing Conventions

| Convention     | Pattern                                                                                        |
| -------------- | ---------------------------------------------------------------------------------------------- |
| Framework      | Vitest 4 with Angular TestBed                                                                  |
| Mocking        | `vi.spyOn()`, `vi.fn()`, `vi.mockImplementation()`                                             |
| Signal effects | `TestBed.flushEffects()`                                                                       |
| HTTP testing   | `provideHttpClientTesting()` + `HttpTestingController` + `httpTesting.verify()` in `afterEach` |
| Setup          | `beforeEach`: clear localStorage, reset document state, mock `window.matchMedia`               |
| Cleanup        | `afterEach`: restore mocks, clear localStorage, verify HTTP                                    |
| Coverage       | 80% thresholds (statements, branches, functions, lines)                                        |
| File naming    | `foo.spec.ts` alongside `foo.ts`                                                               |

### Test File Template

```typescript
import { TestBed } from '@angular/core/testing';
import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';

describe('MyService', () => {
  let service: MyService;

  beforeEach(() => {
    localStorage.clear();
    TestBed.configureTestingModule({});
    service = TestBed.inject(MyService);
  });

  afterEach(() => {
    localStorage.clear();
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});
```

## Environment & Build

### Scripts

| Command                 | Purpose                              |
| ----------------------- | ------------------------------------ |
| `npm start`             | Dev server → http://localhost:4200   |
| `npm test`              | Vitest unit tests                    |
| `npm run test:coverage` | V8 coverage (80% thresholds)         |
| `npm run build`         | Production build                     |
| `npm run lint`          | ESLint                               |
| `npm run lint:fix`      | ESLint auto-fix                      |
| `npm run format`        | Prettier                             |
| `npm run e2e`           | Playwright (Chrome, Firefox, WebKit) |

### Environment Variables

| Variable   | Dev                         | Production | Staging                               |
| ---------- | --------------------------- | ---------- | ------------------------------------- |
| production | false                       | true       | true                                  |
| apiUrl     | `http://localhost:3000/api` | `/api`     | `https://staging-api.example.com/api` |

### Build Verification

After any code change, always run:

```bash
npm run build && npm test
```

Run `npm run lint` if you touched `.ts` or `.html` files.

## Naming Conventions

| Category            | Pattern                           | Example                                                        |
| ------------------- | --------------------------------- | -------------------------------------------------------------- |
| Files               | kebab-case, **no suffix**         | `theme-toggle.ts`, not `theme-toggle.component.ts`             |
| Spec files          | Same name + `.spec`               | `theme-toggle.spec.ts`                                         |
| Component selectors | `app-` prefix                     | `app-theme-toggle`                                             |
| Services            | `*.service.ts`                    | `theme.service.ts`                                             |
| Interceptors        | `*.interceptor.ts`                | `api.interceptor.ts`                                           |
| Guards              | `*.guard.ts`                      | `auth.guard.ts`                                                |
| Feature folders     | Under `features/`                 | `features/dashboard/`                                          |
| Component folders   | Under `shared/components/`        | `shared/components/theme-toggle/`                              |
| Interfaces/Models   | Under `core/models/`              | `core/models/student.ts` (not yet created)                     |
| Path aliases        | Always for cross-boundary imports | `import { ThemeService } from '@core/services/theme.service';` |

## Feature Modules (Existing)

| Feature | Path      | Status          | Components | Services |
| ------- | --------- | --------------- | ---------- | -------- |
| (none)  | features/ | Empty directory | -          | -        |

**Project is freshly scaffolded.** Core infrastructure (theme, i18n, interceptors, guards, error handling) is in place. No feature modules have been implemented yet.

---

## Gaps (Backend Features Without Frontend Implementation)

Cross-referenced with `docs/backend-reference.md`. The following backend modules have NO frontend implementation:

### Authentication & User Management

- [ ] Login page (POST /auth/login)
- [ ] Forgot/reset password flow
- [ ] Auth service (token storage, refresh, logout)
- [ ] User management CRUD
- [ ] Role & permission management

### Academic Structure

- [ ] Academic year management
- [ ] Term management
- [ ] Grade management
- [ ] Subject management
- [ ] Class section management
- [ ] Department management

### People Management

- [ ] Student CRUD + search
- [ ] Teacher CRUD + search + subject assignment
- [ ] Guardian CRUD + student-guardian linking
- [ ] Enrollment management + bulk promotion

### Scheduling

- [ ] Period set / working day / period configuration
- [ ] Time slot generation
- [ ] Room management
- [ ] Lesson CRUD + bulk create + auto-generate
- [ ] Timetable views (class/teacher/room)
- [ ] Substitution management

### Daily Operations

- [ ] Student attendance (bulk record, summary)
- [ ] Teacher attendance
- [ ] Teacher availability
- [ ] Teacher leave management (request, approve, reject)

### Assessment & Grades

- [ ] Grading scale configuration
- [ ] Exam management
- [ ] Exam subject configuration
- [ ] Student grade entry (bulk)
- [ ] Grade reports
- [ ] Report card generation + viewing

### Finance

- [ ] Fee category management
- [ ] Fee structure management
- [ ] Fee discount management
- [ ] Fee invoice CRUD + bulk generation
- [ ] Fee payment recording
- [ ] Financial reports (outstanding, collection, balances, breakdown)

### Communication

- [ ] Announcement management (draft, publish, target)
- [ ] Notification center (list, read, send)
- [ ] Academic calendar / events

### Platform & Admin

- [ ] Dashboard (overview, attendance, fees, activity)
- [ ] Platform admin (school management, super admin dashboard)
- [ ] Audit log viewer

### Self-Service Portals

- [ ] Teacher portal (my classes, timetable, leaves, substitutions)
- [ ] Student portal (my grades, attendance, report cards, invoices)
- [ ] Guardian portal (my children, child grades/attendance/reports/invoices)
